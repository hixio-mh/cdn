/**
  * v1.0.65 generated on: Sat Jul 02 2016 20:12:37 GMT+0000 (UTC)
  * Copyright (c) 2014-2016, Ecor Ventures LLC. All Rights Reserved. See LICENSE (BSD).
  */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();NGN.DATA=NGN.DATA||{},NGN.DATA.util={},Object.defineProperties(NGN.DATA.util,{crcTable:NGN["private"](null),makeCRCTable:NGN.privateconst(function(){for(var e=void 0,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}),checksum:NGN["const"](function(e){for(var t=this.crcTable||(this.crcTable=this.makeCRCTable()),i=-1,n=0;n<e.length;n++)i=i>>>8^t[255&(i^e.charCodeAt(n))];return(i^-1)>>>0}),GUID:NGN["const"](function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&a]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]})});var Model=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this)),n=i;Object.defineProperties(i,{idAttribute:NGN.privateconst(e.idAttribute||"id"),fields:NGN["private"](e.fields||{id:{required:!0,type:String,"default":e.id||null}}),joins:NGN["private"](e.relationships||{}),virtuals:NGN["private"](e.virtuals||{}),validators:NGN["private"]({}),validation:NGN["public"](NGN.coalesce(e.validation,!0)),isNew:NGN["private"](!0),isDestroyed:NGN["private"](!1),oid:NGN["private"](e[i.idAttribute]||null),autoid:NGN["public"](NGN.coalesce(e.autoid,!1)),benchmark:NGN["private"](null),setUnmodified:NGN.privateconst(function(){this.benchmark=this.checksum,this.changelog=[]}),allowInvalidSave:NGN["private"](NGN.coalesce(e.allowInvalidSave,!1)),disableDataValidation:NGN["private"](NGN.coalesce(e.disableDataValidation,!1)),invalidDataAttributes:NGN["private"]([]),initialDataAttributes:NGN["private"]([]),changelog:NGN["private"]([]),_nativeValidators:NGN.privateconst({min:function(e,t){return t instanceof Array?t.length>=e:t instanceof Number?t>=e:t instanceof String?t.trim().length>=e:t instanceof Date&&t.parse()>=e.parse()},max:function(e,t){return t instanceof Array?t.length<=e:t instanceof Number?t<=e:t instanceof String?t.trim().length<=e:t instanceof Date&&t.parse()<=e.parse()},"enum":function(e,t){return e.indexOf(t)>=0},required:function(e){return this.hasOwnProperty(e)}}),_dataMap:NGN["private"](e.dataMap||null),_reverseDataMap:NGN["public"](null),raw:NGN["private"]({}),rawjoins:NGN["private"]({}),_store:NGN["private"](null)});var r=i.datafields.concat(i.virtualdatafields).concat(i.relationships).filter(function(e,t,i){return i.indexOf(e)!==t});if(r.length>0)throw new Error("Duplicate field names exist: "+r.join(", ")+". Unique fieldnames are required for data fields, virtuals, and relationship fields.");i.fields.hasOwnProperty("id")||(e.fields.id={required:!0,type:String,"default":e.id||null}),Object.keys(i.fields).forEach(function(e){n.addField(e,!0)}),Object.keys(i.virtuals).forEach(function(e){Object.defineProperty(n,e,NGN.get(function(){return n.virtuals[e].apply(n)}))}),Object.keys(i.joins).forEach(function(e){n.addRelationshipField(e,n.joins[e],!0)});var a=["field.update","field.create","field.remove","field.invalid","validator.add","validator.remove","relationship.create","relationship.remove"];return NGN.BUS&&a.forEach(function(e){n.on(e,function(){var e=NGN.slice(arguments);e.push(n),NGN.BUS.emit.apply(NGN.BUS,e)})}),i}return _inherits(t,e),_createClass(t,[{key:"addValidator",value:function(e,t){if(!this.hasOwnProperty(e))return void console.warn("No validator could be create for "+e.toUpperCase()+". It is not an attribute of "+this.type.toUpperCase()+".");switch("undefined"==typeof t?"undefined":_typeof(t)){case"function":this.validators[e]=this.validators[e]||[],this.validators[e].push(t),this.emit("validator.add",e);break;case"object":Array.isArray(t)?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.indexOf(e)>=0}),this.emit("validator.add",e)):t.test?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.test(e)}),this.emit("validator.add",e)):console.warn("No validator could be created for "+e.toUpperCase()+". The validator appears to be invalid.");break;case"string":case"number":case"date":this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return e===t}),this.emit("validator.add",e);break;default:console.warn("No validator could be create for "+e.toUpperCase()+". The validator appears to be invalid.")}}},{key:"removeValidator",value:function(e){this.validators.hasOwnProperty(e)&&(delete this.validators[e],this.emit("validator.remove",e))}},{key:"validate",value:function(e){var t=!0,i=this;if(e&&this.validators.hasOwnProperty(e)){for(var n=0;n<this.validators[e].length;n++)if(!i.validators[e][n](i[e]))return i.invalidDataAttributes.indexOf(e)<0&&i.invalidDataAttributes.push(e),!1;return!0}for(var r in this.validators)if(this[r]&&this.validators.hasOwnProperty(r)){for(var a=!0,o=0;o<this.validators[r].length&&(a=this.validators[r][o](this[r]));o++);!a&&this.invalidDataAttributes.indexOf(r)<0&&this.invalidDataAttributes.push(r),t&&!a&&(t=!1)}return!0}},{key:"getRelationshipField",value:function(e){return this.joins[e]}},{key:"hasRelationship",value:function(e){return this.joins.hasOwnProperty(e)}},{key:"getDataField",value:function(e){return this.fields[e]}},{key:"hasDataField",value:function(e){return this.fields.hasOwnProperty(e)}},{key:"serialize",value:function(e){var t=e||this.raw,i={};for(var n in t)if(t.nonEnumerableProperties=t.nonEnumerableProperties||"",this.fields.hasOwnProperty(n)&&(n="id"===n?this.idAttribute:n,t.hasOwnProperty(n)&&t.nonEnumerableProperties.indexOf(n)<0&&/^[a-z0-9 ]$/.test(n.substr(0,1))||void 0!==t[n]&&t.enumerableProperties.indexOf(n)>=0)){var r=Object.getOwnPropertyDescriptor(t,n);if(!r.set)switch(_typeof(r.value)){case"function":"Date"===r.value.name?i[n]=t[n].refs.toJSON():"RegExp"===r.value.name&&(i[n]=r.value());break;case"object":t[n]instanceof Array&&!Array.isArray(t[n])&&(t[n]=t[n].slice(0)),i[n]=t[n];break;default:i[n]=t[n]}}var a=this;return this.relationships.forEach(function(e){i[e]=a[e].data}),i}},{key:"addField",value:function(e,t,i){"boolean"==typeof t&&(i=t,t=null),i=void 0!==i&&i;var n=this,r=null;if("id"!==e.toLowerCase()){if("object"===("undefined"==typeof e?"undefined":_typeof(e))){if(!e.name)throw new Error("Cannot create data field. The supplied configuration does not contain a unique data field name.");r=e,e=r.name,delete r.name}if(void 0!==n[e]&&(console.warn(e+" data field defined multiple times. Only the last defintion will be used."),delete n[e]),n.fields[e]=r||n.fields[e]||{},n.fields[e].required=NGN.coalesce(n.fields[e].required,!1),n.fields[e].type=NGN.coalesce(n.fields[e].type,String),e===n.idAttribute&&n.autoid===!0?(n.fields[e].type=String,n.fields[e]["default"]=NGN.DATA.util.GUID()):n.fields[e]["default"]=n.fields[e]["default"]||null,n.raw[e]=n.fields[e]["default"],n[e]=n.raw[e],Object.defineProperty(n,e,{get:function(){return n.raw[e]},set:function(t){var i=n.raw[e];n.raw[e]=t;var r={action:"update",field:e,old:i,"new":n.raw[e]};this.changelog.push(r),this.emit("field.update",r),n.validate(e)||n.emit("field.invalid",{field:e})}}),!i){var a={action:"create",field:e};this.changelog.push(a),this.emit("field.create",a)}n.fields.hasOwnProperty(e)&&(n.fields[e].hasOwnProperty("pattern")&&n.addValidator(e,n.fields[e].pattern),["min","max","enum"].forEach(function(t){n.fields[e].hasOwnProperty(t)&&n.addValidator(e,function(i){return n._nativeValidators[t](n.fields[e],i)})}),n.fields[e].hasOwnProperty("required")&&n.fields[e].required&&n.addValidator(e,function(e){return n._nativeValidators.required(e)}),n.fields[e].hasOwnProperty("validate")&&("function"==typeof n.fields[e]?n.addValidator(e,function(t){return n.fields[e](t)}):console.warn("Invalid custom validation function. The value passed to the validate attribute must be a function.")))}else null===n.id&&n.autoid&&(n.id=NGN.DATA.util.GUID())}},{key:"addVirtual",value:function(e,t){var i=this;Object.defineProperty(this,e,{get:function(){return t.apply(i)}})}},{key:"addRelationshipField",value:function(e,t,i){if(i=void 0!==i&&i,this.rawjoins.hasOwnProperty(e)||this.fields.hasOwnProperty(e)||this.hasOwnProperty(e))throw new Error(e+" already exists. It cannot be added to the model again.");if(("function"==typeof t||"object"===("undefined"==typeof t?"undefined":_typeof(t))&&!t.hasOwnProperty("type"))&&(t={type:t}),!t.type)throw new Error("Configuration has no reference! The reference must be an NGN.DATA.Model or NGN.DATA.Store.");t.required=NGN.coalesce(t.required,!0),t["default"]=t["default"]||null;var n=this,r="model";if(t.type instanceof NGN.DATA.Store?r="store":"object"===_typeof(t.type)&&t.type.model&&(r="store"),"store"===r){var a={};if(t.type instanceof NGN.DATA.Store)return void(this.rawjoins[e]=t.type);if(!t.type.model)throw new Error("Nested store configuration is invalid or was not recognized.");a=t.type,this.rawjoins[e]=new NGN.DATA.Store(a),this.applyStoreMonitor(e)}else if(t.type.data){if(!t.type.data)throw new Error("Nested store configuration is invalid or was not recognized.");this.rawjoins[e]=t.type,this.applyStoreMonitor(e)}else this.rawjoins[e]=null!==t["default"]?new t.type(t["default"]):new t.type,this.applyModelMonitor(e);if(Object.defineProperty(this,e,{enumerable:!0,get:function(){return n.rawjoins[e]}}),!i){var o={action:"create",field:e};this.changelog.push(o),this.emit("relationship.create",o)}}},{key:"applyModelMonitor",value:function(e){var t=this.rawjoins[e],i=this;t.on("field.update",function(t){i.emit("field.update",{action:"update",field:e+"."+t.field,old:t.old,"new":t["new"],join:!0})}),t.on("field.create",function(t){i.emit("field.update",{action:"update",field:e+"."+t.field,old:null,"new":null,join:!0})}),t.on("field.remove",function(t){i.emit("field.update",{action:"update",field:e+"."+t.field,old:t.value,"new":null,join:!0})})}},{key:"applyStoreMonitor",value:function(e){var t=this;this.rawjoins.hasOwnProperty(e)&&this.rawjoins[e].hasOwnProperty("proxy")&&!function(){var i=t;t.rawjoins[e].on("record.create",function(t){var n=i[e].data;n.pop();var r={action:"update",field:e,join:!0,old:n,"new":i[e].data};i.emit("field.update",r)}),t.rawjoins[e].on("record.update",function(t,n){if(n){var r={action:"update",field:e+"."+n.field,join:!0,old:n.old,"new":n["new"]};i.emit("field.update",r)}}),t.rawjoins[e].on("record.delete",function(t){var n=i[e].data;n.push(t.data);var r={action:"update",field:e,join:!0,old:n,"new":i[e].data};i.emit("field.update",r)})}()}},{key:"removeField",value:function(e){if(this.raw.hasOwnProperty(e)){var t=this.raw[e];delete this[e],delete this.fields[e],delete this.raw[e],this.invalidDataAttributes.indexOf(e)>=0&&this.invalidDataAttributes.splice(this.invalidDataAttributes.indexOf(e),1);var i={action:"delete",field:e,value:t};this.emit("field.remove",i),this.changelog.push(i)}}},{key:"removeVirtual",value:function(e){delete this[e]}},{key:"removeRelationshipField",value:function(e,t){if(t=void 0!==t&&t,this.joins.hasOwnProperty(e)){var i=this.rawjoins[e];if(delete this.rawjoins[e],delete this[e],delete this.joins[e],!t){var n={action:"delete",field:e,old:i,join:!0};this.changelog.push(n),this.emit("relationship.remove",n)}}}},{key:"undo",value:function(e){e=e||1;var t=this.changelog.splice(this.changelog.length-e,e),i=this;t.reverse().forEach(function(e){if("boolean"==typeof e.join&&e.join)switch(e.action){case"create":i.removeRelationshipField(e.field);break;case"delete":i.addRelationshipField(e.field),i[e.field]=e.old}else switch(e.action){case"update":i[e.field]=e.old;break;case"create":i.removeField(e.field);break;case"delete":i.addField(e.field),i[e.field]=i.old}})}},{key:"load",value:function(e){e=e||{};var t=this;null!==this._dataMap&&Object.keys(this.reverseMap).forEach(function(i){e.hasOwnProperty(i)&&(e[t.reverseMap[i]]=e[i],delete e[i])}),Object.keys(e).forEach(function(i){if(t.fields.hasOwnProperty(i))t.raw.hasOwnProperty(i)?t.raw[i]=e[i]:i===t.idAttribute&&(t.id=e[i]);else if(t.joins.hasOwnProperty(i)){var n=new t.getRelated(i).type();n.load(e[i]),t.rawjoin[i]=n}else console.warn(i+" was specified as a data field but is not defined in the model.")}),this.setUnmodified()}},{key:"modified",get:function(){return this.checksum!==this.benchmark}},{key:"id",get:function(){return this.oid},set:function(e){this.oid=e}},{key:"checksum",get:function(){return NGN.DATA.util.checksum(JSON.stringify(this.data))}},{key:"dataMap",get:function(){return this._dataMap},set:function(e){this._dataMap=e,this._reverseDataMap=null}},{key:"datastore",get:function(){return this._store}},{key:"valid",get:function(){return 0===this.invalidDataAttributes.length}},{key:"datafields",get:function(){return Object.keys(this.fields)}},{key:"relationships",get:function(){return Object.keys(this.joins)}},{key:"virtualdatafields",get:function(){return Object.keys(this.virtuals)}},{key:"reverseMap",get:function(){var e=this;if(null!==this.dataMap){var t=function(){if(null!==e._reverseDataMap)return{v:e._reverseDataMap};var t={},i=e;return Object.keys(e._dataMap).forEach(function(e){t[i._dataMap[e]]=e}),e._reverseDataMap=t,{v:t}}();if("object"===("undefined"==typeof t?"undefined":_typeof(t)))return t.v}return null}},{key:"data",get:function(){var e=this,t=this.serialize();return!t.hasOwnProperty(this.idAttribute)&&this.autoid&&(t[this.idAttribute]=this[this.idAttribute]),this.dataMap&&!function(){var i=e;Object.keys(e.dataMap).forEach(function(e){t.hasOwnProperty(e)&&(t[e]instanceof NGN.DATA.Model?t[i.dataMap[e]]=t[e].data:t[i.dataMap[e]]=t[e],delete t[e])})}(),t}},{key:"history",get:function(){return this.changelog.reverse()}}]),t}(NGN.EventEmitter);NGN.DATA=NGN.DATA||{},Object.defineProperties(NGN.DATA,{Model:NGN["public"](function(e){var t=function(t){var i=new Model(e);return t&&i.load(t),i};return t}),Entity:NGN["private"](Model)}),NGN.nodelike&&(module.exports=NGN.DATA);var Store=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));Object.defineProperties(i,{model:NGN["const"](e.model||null),_data:NGN["private"]([]),_filters:NGN["private"]([]),_index:NGN["private"](e.index||[]),_created:NGN["private"]([]),_deleted:NGN["private"]([]),_loading:NGN["private"](!1),proxy:NGN["private"](null),allowDuplicates:NGN["public"](NGN.coalesce(e.allowDuplicates,!0)),errorOnDuplicate:NGN["const"](NGN.coalesce(e.errorOnDuplicate,e.allowDuplicates,!0))});var n={};i._index.forEach(function(e){n[e]=[]}),i._index=n;var r=["record.duplicate","record.create","record.update","record.delete","clear","filter.create","filter.delete","index.create","index.delete"];return NGN.BUS&&!function(){var e=i;r.forEach(function(t){e.on(t,function(){var i=NGN.slice(arguments);i.shift(),i.push(e),NGN.BUS.emit(t,i)})})}(),i}return _inherits(t,e),_createClass(t,[{key:"add",value:function(e,t){var i=void 0,n=this;if(e instanceof NGN.DATA.Entity)i=e;else{try{e=JSON.parse(e)}catch(r){}if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("Cannot add a non-object record.");i=this.model?new this.model(e):e}i.hasOwnProperty("_store")&&(i._store=n);var a=this.isDuplicate(i);if(!a||(this.emit("record.duplicate",i),this.allowDuplicates))this.listen(i),this.applyIndices(i,this._data.length),this._data.push(i),!this._loading&&this._created.indexOf(i)<0&&this._created.push(i),!NGN.coalesce(t,!1)&&this.emit("record.create",i);else if(this.errorOnDuplicate)throw new Error("Cannot add duplicate record (allowDuplicates = false).")}},{key:"isDuplicate",value:function(e){return!(this._data.indexOf(e)>=0)&&this._data.filter(function(t){return t.checksum===e.checksum}).length>0}},{key:"listen",value:function(e){var t=this;e.on("field.update",function(i){t.updateIndice(i.field,i.old,i["new"],t._data.indexOf(e)),t.emit("record.update",e,i)}),e.on("field.delete",function(i){t.updateIndice(i.field,i.old,void 0,t._data.indexOf(e)),t.emit("record.update",e,i)})}},{key:"bulk",value:function(e,t){this._loading=!0;var i=this;t.forEach(function(e){i.add(e,!0)}),this._loading=!1,this._deleted=[],this._created=[],this.emit(e||"load")}},{key:"load",value:function(){var e=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("load",e)}},{key:"reload",value:function(e){this.clear();var t=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("reload",t)}},{key:"indexOf",value:function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&(e instanceof NGN.DATA.Entity||e.checksum)?this._data.findIndex(function(t){return t.checksum===e.checksum}):-1}},{key:"contains",value:function(e){return this.indexOf(e)>=0}},{key:"remove",value:function(e,t){var i=this,n=[],r=void 0;if("number"==typeof e?r=e:e&&e.checksum&&null!==e.checksum||e instanceof NGN.DATA.Model?r=this.indexOf(e):!function(){var t=new i.model(e,(!0));r=i._data.findIndex(function(e){return e.checksum===t.checksum})}(),r<0)throw new Error("Record removal failed (record not found at index "+(r||"").toString()+").");if(n=this._data.splice(r,1),n.length>0){if(n=n[0],this.unapplyIndices(r),!this._loading){var a=this._created.indexOf(n);a>=0?a>=0&&this._created.splice(a,1):this._deleted.indexOf(n)<0&&this._deleted.push(n)}NGN.coalesce(t,!1)||this.emit("record.delete",n)}}},{key:"clear",value:function(){this._data=[];var e=this;Object.keys(this._index).forEach(function(t){e._index[t]=[]}),this.emit("clear")}},{key:"find",value:function(e,t){var i=this;if(0===this._data.length)return[];var n=[],r=this,a=function(){switch("undefined"==typeof e?"undefined":_typeof(e)){case"function":n=i._data.filter(e);break;case"number":n=e<0||e>=i._data.length?null:i._data[e];break;case"string":var t=i.getIndices(i._data[0].idAttribute,e.trim());if(null!==t&&t.length>0)return t.forEach(function(e){n.push(r._data[e])}),{v:n};var a=i._data.filter(function(t){return(t[t.idAttribute]||"").toString().trim()===e.trim()});n=0===a.length?null:a[0];break;case"object":if(e instanceof NGN.DATA.Model)return i.contains(e)?{v:e}:{v:null};var o=[],s=[],l=Object.keys(e);l.forEach(function(t){var i=r.getIndices(t,e[t]);i?o=o.concat(i||[]):null!==t&&s.push(t)}),o.filter(function(e,t){return o.indexOf(e)===t}),s.length>0&&(n=i._data.filter(function(t,i){if(o.indexOf(i)>=0)return!1;for(var n=0;n<s.length;n++)if(t[s[n]]!==e[s[n]])return!1;return!0})),n=n.concat(o.map(function(e){return r._data[e]})).filter(function(t){for(var i=0;i<l.length;i++)if(e[l[i]]!==t[l[i]])return!1;return!0});break;default:n=i._data}}();return"object"===("undefined"==typeof a?"undefined":_typeof(a))?a.v:null===n?null:(NGN.coalesce(t,!1)||this.applyFilters(n instanceof Array?n:[n]),n)}},{key:"applyFilters",value:function(e){return 0===this._filters.length?e:(this._filters.forEach(function(t){e=e.filter(t)}),e)}},{key:"addFilter",value:function(e){this._filters.push(e),this.emit("filter.create",e)}},{key:"removeFilter",value:function(e,t){t=NGN.coalesce(t,!1);var i=[];i="number"==typeof e?this._filters.splice(e,1):this._filters.splice(this._filters.indexOf(e),1),i.length>0&&!t&&this.emit("filter.delete",i[0])}},{key:"clearFilters",value:function(e){if(e=NGN.coalesce(e,!1))return void(this._filters=[]);for(var t=this;this._filters.length>0;)t.emit("filter.delete",this._filters.pop())}},{key:"deduplicate",value:function(e){e=NGN.coalesce(e,!0);var t=this.data.map(function(e){return JSON.stringify(e)}),i=[],n=this;t.forEach(function(e,r){t.indexOf(e)<r&&i.push(n.find(r))}),i.forEach(function(e){n.remove(e)})}},{key:"sort",value:function(e){var t=this;"function"==typeof e?this.records.sort(e):"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!function(){var i=Object.keys(e);t.records.sort(function(t,n){for(var r=0;r<i.length;r++){if(t.hasOwnProperty(i[r])&&!n.hasOwnProperty(i[r]))return 1;if(!t.hasOwnProperty(i[r])&&n.hasOwnProperty(i[r]))return-1;if(t[i[r]]!==n[i[r]])switch(e[i[r]].toString().trim().toLowerCase()){case"asc":return t[i[r]]>n[i[r]]?1:-1;case"desc":return t[i[r]]<n[i[r]]?1:-1;default:return"function"==typeof e[i[r]]?e[i[r]](t,n):0}}return 0})}(),this.reindex()}},{key:"createIndex",value:function(e,t){this.model.hasOwnProperty(e)||console.warn("The store's model does not contain a data field called "+e+".");var i=this._index.hasOwnProperty(e);this._index[e]=this._index[e]||[],NGN.coalesce(t,!1)||i||this.emit("index.created",{field:e,store:this})}},{key:"deleteIndex",value:function(e,t){this._index.hasOwnProperty(e)&&(delete this._index[e],NGN.coalesce(t,!1)||this.emit("index.created",{field:e,store:this}))}},{key:"clearIndices",value:function(){var e=this;Object.keys(this._index).forEach(function(t){e._index[t]=[]})}},{key:"deleteIndexes",value:function(e){e=NGN.coalesce(e,!0);var t=this;Object.keys(this._index).forEach(function(i){t.deleteIndex(i,e)})}},{key:"applyIndices",value:function(e,t){var i=Object.keys(this._index);if(0!==i.length){var n=this;i.forEach(function(i){if(e.hasOwnProperty(i)){for(var r=n._index[i],a=0;a<r.length;a++)if(r[a][0]===e[i])return void n._index[i][a].push(t);n._index[i].push([e[i],t])}})}}},{key:"unapplyIndices",value:function(e){var t=this;Object.keys(this._index).forEach(function(i){var n=t._index[i].indexOf(e);n>=0&&t._index[i].splice(n,1)})}},{key:"updateIndice",value:function(e,t,i,n){if(this._index.hasOwnProperty(e)&&t!==i)for(var r=0,a=this,o=0;o<a._index[e].length;o++){var s=a._index[e][o][0];if(s===t?(a._index[e][o].splice(a._index[e][o].indexOf(n),1),r++):void 0===i?r++:s===i&&(a._index[e][o].push(n),a._index[e][o].shift(),a._index[e][o].sort(),a._index[e][o].unshift(s),r++),2===r)return}}},{key:"getIndices",value:function(e,t){if(!this._index.hasOwnProperty(e))return null;var i=this._index[e].filter(function(e){return e.length>0&&e[0]===t});return 1===i.length?(i[0].shift(),i[0]):[]}},{key:"reindex",value:function(){this.clearIndices();var e=this;this._data.forEach(function(t,i){e.applyIndices(t,i)})}},{key:"data",get:function(){return this._data.map(function(e){return e.data})}},{key:"records",get:function(){return this.applyFilters(this._data)}},{key:"recordCount",get:function(){return this.applyFilters(this._data).length}},{key:"filtered",get:function(){var e=this.records;return this._data.filter(function(t){return 0===e.filter(function(e){return e.checksum===t.checksum}).length})}}]),t}(NGN.EventEmitter);NGN.DATA.Store=Store;var Proxy=function(e){function t(e){if(_classCallCheck(this,t),e=e||{},!e.store)throw new Error("NGN.DATA.Proxy requires a NGN.DATA.Store.");var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.store.proxy=i,Object.defineProperties(i,{store:NGN["const"](e.store),url:NGN["public"](e.url||"http://localhost"),username:NGN["public"](e.username||null),password:NGN["public"](e.password||null),token:NGN["public"](e.token||null)}),i}return _inherits(t,e),_createClass(t,[{key:"save",value:function(){console.warn("Save should be overridden by a proxy implementation class.")}},{key:"fetch",value:function(){console.warn("Fetch should be overridden by a proxy implementation class.")}},{key:"actions",get:function(){var e=this;return{create:this.store._created,update:this.store.records.filter(function(t){return!(e.store._created.indexOf(t)<0&&e.store._deleted.indexOf(t)<0)&&t.modified}).map(function(e){return e}),"delete":this.store._deleted}}}]),t}(NGN.EventEmitter);Object.defineProperty(NGN.DATA,"Proxy",NGN["const"](Proxy));