/**
  * v1.0.120 generated on: Thu Aug 11 2016 20:07:40 GMT+0000 (UTC)
  * Copyright (c) 2014-2016, Ecor Ventures LLC. All Rights Reserved. See LICENSE (BSD).
  */
"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();if(window.NGN={},Object.defineProperty(NGN,"define",{enumerable:!1,writable:!1,configurable:!1,value:function(e,t,i,n){return{enumerable:e,writable:t,configurable:i,value:n}}}),Object.defineProperties(NGN,{"public":NGN.define(!1,!1,!1,function(e){return NGN.define(!0,"function"!=typeof e,!1,e)}),"private":NGN.define(!1,!1,!1,function(e){return NGN.define(!1,"function"!=typeof e,!1,e)}),"const":NGN.define(!1,!1,!1,function(e){return NGN.define(!0,!1,!1,e)}),privateconst:NGN.define(!1,!1,!1,function(e){return NGN.define(!1,!1,!1,e)}),get:NGN.define(!1,!1,!1,function(e){return{enumerable:!1,get:e}}),set:NGN.define(!1,!1,!1,function(e){return{enumerable:!1,set:e}})}),Object.defineProperties(NGN,{extend:NGN.privateconst(function(e,t){Object.defineProperty(this,e,t)}),inherit:NGN["const"](function(e,t){e&&t&&(e="function"==typeof e?e.prototype:e,t="function"==typeof t?t.prototype:t,Object.getOwnPropertyNames(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n)}))}),slice:NGN["private"](function(e){return Array.prototype.slice.call(e)}),splice:NGN["private"](function(e){return Array.prototype.splice.call(e)}),coalesce:NGN["public"](function(){for(var e in arguments)if(void 0!==arguments[e]&&null!==arguments[e])return arguments[e];return null}),nodelike:NGN.get(function(){var e=!1;try{e=void 0!==require}catch(t){}return e}),dedupe:NGN["private"](function(e){return e.filter(function(t,i){return e.indexOf(t)===i})}),"typeof":NGN.define(!1,!1,!1,function(e){var t=Object.prototype.toString.call(e).split(" ")[1].replace(/\]|\[/gi,"").toLowerCase();if("function"===t){if(!e.name)return e.toString().replace(/\n/gi,"").replace(/^function\s|\(.*$/gim,"").toLowerCase();t=e.name||"function"}return t.toLowerCase()}),stack:NGN.get(function(){var e=this,t=((new Error).stack.split("\n"),(new Error).stack.split("\n")||[]);return t=t.filter(function(e){return e.split(":").length>1}).map(function(t){return t=t.replace(/^.*\s\(/i,"").replace(/\)/gi,"").replace(/^.*\@/i,"").replace(void 0!==window?window.location.origin:void 0!==process?process.cwd():"","").replace(/^.*\:\/\//,"").replace(/\s{1,100}at\s{1,100}/gi,"").replace(/anonymous\>/,"console").trim().split(":"),{path:t[0].substr(e.nodelike?0:1,t[0].length-(e.nodelike?0:1))+":"+t[1]+":"+t[2],file:t[0].substr(e.nodelike?0:1,t[0].length-(e.nodelike?0:1)),line:parseInt(t[1],10),column:parseInt(t[2],10)}}),0===t.length?[{path:"unknown",file:"unknown",line:0,column:0}]:(e.nodelike&&t.reverse(),t)}),css:NGN.privateconst("font-weight: bold;")}),Object.defineProperty(NGN,"global",NGN.privateconst(NGN.nodelike?global:window)),document.addEventListener("DOMContentLoaded",function(){document.body.classList.add("ngn")}),!window.NGN)throw new Error("The EventEmitter class is dependent on the presence of NGN.");var EventEmitter=function(){function e(t){_classCallCheck(this,e),t=t||{},Object.defineProperties(this,{handlers:NGN["private"]({}),adhoc:NGN["private"]({}),maxlisteners:NGN["private"](t.defaultMaxListeners||10)})}return _createClass(e,[{key:"listenerCount",value:function(e){return(this.handlers[e]||[]).length+(this.adhoc[e]||[]).length}},{key:"getMaxListeners",value:function(){return this.defaultMaxListeners}},{key:"setMaxListeners",value:function(e){this.defaultMaxListeners=e}},{key:"eventNames",value:function(){var e=Object.keys(this.handlers),t=Object.keys(this.adhoc);return NGN.dedupe(e.concat(t))}},{key:"listeners",value:function(e){var t=this.handlers[e]||[],i=this.adhoc[e]||[];return t.concat(i)}},{key:"on",value:function(e,t,i){if(this.handlers[e]=this.handlers[e]||[],this.handlers[e][NGN.coalesce(i,!1)?"unshift":"push"](t),this.emit("newListener",e,t),this.listenerCount(e)>this.maxlisteners)throw new Error("Maximum event listeners exceeded. Use setMaxListeners() to adjust the level.")}},{key:"addListener",value:function(){this.on.apply(this,arguments)}},{key:"prependListener",value:function(){var e=NGN.slice(arguments).push(!0);this.on.apply(this,e)}},{key:"once",value:function(e,t,i){if(this.adhoc[e]=this.adhoc[e]||[],this.adhoc[e][NGN.coalesce(i,!1)?"unshift":"push"](t),this.emit("newListener",e,t),this.listenerCount(e)>this.maxlisteners)throw new Error("Maximum event listeners exceeded. Use setMaxListeners() to adjust the level.")}},{key:"prependOnceListener",value:function(){var e=NGN.slice(arguments).push(!0);this.once.apply(this,e)}},{key:"off",value:function(e,t){if(this.handlers[e]){if(!t)return void delete this.handlers[e];for(var i=this.handlers[e].indexOf(t);i>=0;)this.handlers[e].splice(i,1),this.emit("removeListener",e,t),i=this.handlers[e].indexOf(t);0===this.handlers[e].length&&delete this.handlers[e]}}},{key:"onceoff",value:function(e,t){if(this.adhoc[e]){if(!t)return void delete this.adhoc[e];for(var i=this.adhoc[e].indexOf(t);i>0;)this.adhoc.splice(i,1),i=this.adhoc[e].indexOf(t);0===this.adhoc[e].length&&delete this.adhoc[e]}}},{key:"removeListener",value:function(){this.off.apply(this,arguments),this.onceoff.apply(this,arguments)}},{key:"clear",value:function(){var e=this;arguments.length>0?NGN.slice(arguments).forEach(function(t){delete e.handlers[t],delete e.adhoc[t]}):(this.handlers={},this.adhoc={})}},{key:"removeAllListeners",value:function(){this.clear.apply(this,arguments)}},{key:"emit",value:function(){var e=NGN.slice(arguments),t=e.shift(),i=this.getAllEvents(t),n={event:t};for(var r in i){var o=this.adhoc[i[r]];if(o)for(delete this.adhoc[i[r]];o.length>0;){var a=o.pop();n.handler=a,a.apply(n,e)}var s=this.handlers[i[r]];if(s)for(var l in s)n.handler=s[l],s[l].apply(n,e)}}},{key:"getAllEvents",value:function(e){var t=Object.keys(this.handlers),i=Object.keys(this.adhoc),n=NGN.dedupe(t.concat(i));return n=n.filter(function(t){return t===e||("regexp"===NGN["typeof"](t)||t.indexOf("*")>=0)&&("regexp"!==NGN["typeof"](t)&&(t=new RegExp(t.replace("*",".*","gi"))),t.test(e))})}},{key:"subscribers",get:function(){var e={};for(var t in this.handlers)e[t]={handler:this.handlers[t].length,adhoc:0};for(var i in this.adhoc)e[i]=e[i]||{handler:0},e[i].adhoc=this.adhoc[i].length;return e}},{key:"defaultMaxListeners",get:function(){return this.maxlisteners},set:function(e){this.maxlisteners=e}}]),e}();NGN.extend("EventEmitter",NGN["private"](EventEmitter)),NGN.inherit(Object.defineProperties({},{queued:NGN["private"]({}),pool:NGN["const"](function(e,t,i){"string"!=typeof e&&(t=e,e="");var n={};for(var r in t){var o=(e.trim()||"")+r;"function"==typeof t[r]?n[r]=this.on(o,t[r]):console.warn("%c"+o+"%c could not be pooled in the event emitter because it's value is not a function.",NGN.css,"")}i&&i(n)}),attach:NGN["const"](function(e,t){var i=this;return t=NGN.coalesce(t,!1),function(n){t&&n.hasOwnProperty("preventDefault")&&n.preventDefault();var r=NGN.slice(arguments);r.unshift(e),i.emit.apply(i,r)}}),bind:NGN["const"](function(e,t,i){t="string"==typeof t?[t]:t;var n=this,r=function(){var e=NGN.slice(arguments);i&&e.push(i);for(var r in t){var o=e.slice();o.unshift(t[r]),n.emit.apply(n,o)}};return this.on(e,r),{remove:function(){n.off(e,r)}}}),queue:NGN["const"](function(e,t){var i=this,n=arguments;this.queued.hasOwnProperty(e)||!function(){var r=i,o=NGN.slice(n);o.splice(1,1),i.queued[e]=setTimeout(function(){delete r.queued[e],r.emit.apply(r,o)},t)}()})}),NGN.EventEmitter);var CustomException=function(e){function t(e){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));e=e||{},e="string"==typeof e?{message:e}:e,e.custom=e.custom||{};var n=i;i.name=e.name||"NgnError",i.type=e.type||"TypeError",i.severity=e.severity||"minor",i.message=e.message||"Unknown Error",i.category=e.category||"operational",i.name=i.name.replace(/[^a-zA-Z0-9_]/gi,"");for(var r in e.custom)e.custom.hasOwnProperty(r)&&(i[r]=e.custom[r]);if(i.hasOwnProperty("custom")&&delete i.custom,NGN.nodelike||Error.prepareStackTrace){Error.prepareStackTrace=function(e,t){return t};var o=new Error;Error.captureStackTrace(o,i),i.rawstack=o.stack,Error.prepareStackTrace=function(e,t){return n.cause&&console.warn(n.cause),n.help&&console.info(n.help),n.name+": "+n.message+"\n"+t.filter(function(e){return e.getFileName()!==__filename&&e.getFileName()}).map(function(e){return"    at "+e}).join("\n")},Error.captureStackTrace(i)}return i}return _inherits(t,e),_createClass(t,[{key:"trace",get:function(){return this.rawstack.filter(function(e){return e.getFileName()!==__filename&&e.getFileName()}).map(function(e){return{filename:e.getFileName(),line:e.getLineNumber(),column:e.getColumnNumber(),functionname:e.getFunctionName(),"native":e.isNative(),eval:e.isEval(),type:e.getTypeName()}})}}]),t}(Error);NGN.nodelike&&(module.exports=CustomException),NGN.extend("createException",NGN["public"](function(e){e=e||{},e="string"==typeof e?{message:e}:e,e.name=e.name||"NgnError",e.name=e.name.replace(/[^a-zA-Z0-9_]/gi,""),NGN.global[e.name]=function(){return arguments.length>0&&(e.message=arguments[0]),new CustomException(e)}})),NGN.DOM={},Object.defineProperties(NGN.DOM,{ready:NGN["const"](function(e){document.addEventListener("DOMContentLoaded",e)}),destroy:NGN["const"](function(e){if("string"==typeof e){var t=e;if(e=document.querySelectorAll(e),0===e.length)return void console.warn('The "'+t+'" selector did not return any elements.');NGN.slice(e).forEach(this.destroy)}else switch(NGN["typeof"](e)){case"array":return void e.forEach(this.destroy);case"nodelist":return void NGN.slice(e).forEach(this.destroy);case"htmlelement":return void e.parentNode.removeChild(e);default:if(/^html.*element$/.test(NGN["typeof"](e)))return void e.parentNode.removeChild(e);console.warn("An unknown error occurred while trying to remove DOM elements."),console.log("Unknown Element",e)}}),findParent:NGN["const"](function(e,t,i){if("string"==typeof e){if(e=document.querySelectorAll(e),0===e.length)return console.warn('"'+e+'" is an invalid CSS selector (Does not identify any DOM elements).'),null;e=e[0]}var n=e.parentNode,r=0;for(i="number"==typeof i?i:-1;null===n.parentNode.querySelector(t)&&"BODY"!==n.nodeName;){if(r++,i>0&&r>i)return null;n=n.parentNode}return n}),indexOfParent:NGN["const"](function(e){return NGN.slice(e.parentNode.children).indexOf(e)})}),NGN.extend("BUS",NGN["const"](new NGN.EventEmitter)),NGN.ref=new function(){var e=function(e,t,i,n,r){if(void 0===NGN.BUS)return console.error("The event BUS is required for "+n+"().");r=NGN.coalesce(r,!1);var o=function(e){r&&e.preventDefault&&e.preventDefault(),NGN.BUS.emit(t,e)};i.addEventListener(e,o)},t=function(e,t,i){return"string"==typeof e?document[i?"querySelector":"querySelectorAll"]((e+" > "+t).trim()):e[i?"querySelector":"querySelectorAll"](t.trim())};Object.defineProperties(this,{keys:NGN.define(!1,!0,!1,{}),_find:NGN.define(!1,!1,!1,function(e,t){if("string"==typeof e){var i=NGN.ref.find((e+" > "+t).trim());if(0===i.length){var n=NGN.ref.find(e.trim())[0].parentNode.querySelectorAll(t);if(n.length>0)return 1===n.length?n[0]:n}return i}return NGN.ref.find(e.querySelectorAll(t))}),find:NGN.define(!1,!1,!1,function(i){var n="string"!=typeof i,r=n===!1?document.querySelectorAll(i):i,o=null;if(1===r.length)r[0].hasOwnProperty("isArray")||Object.defineProperties(r[0],{isArray:NGN.get(function(){return!1},!1)}),r[0].hasOwnProperty("find")||Object.defineProperty(r[0],"find",NGN["const"](function(e){return NGN.ref._find(i,e)})),r[0].hasOwnProperty("forward")||Object.defineProperty(r[0],"forward",NGN["const"](function(t,i){e(t,i,this,"forward")})),r[0].hasOwnProperty("on")||Object.defineProperty(r[0],"on",NGN["const"](function(){this.addEventListener.apply(this,arguments)})),o=r[0];else{var a=NGN.slice(r);"nodelist"===NGN["typeof"](r)&&1===a.length&&(a=a[0]),Object.defineProperties(a,{querySelector:NGN.define(!1,!1,!1,function(e){t(i,e)}),querySelectorAll:NGN.define(!1,!1,!1,function(e){t(i,e,!0)}),addEventListener:NGN.define(!1,!1,!1,function(e,t){for(var i=0;i<this.length;i++)this[i].addEventListener(e,t)}),removeEventListener:NGN.define(!1,!1,!1,function(e,t){for(var i=0;i<this.length;i++)this[i].removeEventListener(e,t)}),find:NGN["const"](function(e){return NGN.ref._find(i,e)}),isArray:NGN.get(function(){return!0},!1),forward:NGN.define(!1,!1,!1,function(t,i){e(t,i,this,"forward")})}),o=a}return o}),create:NGN["const"](function(e,t){if(!t&&"string"!=typeof e)return this.find(e);if("string"!=typeof e&&"number"!=typeof e)throw new Error("Cannot add a non-alphanumeric selector reference.");if(0===e.trim().length)throw new Error("Cannot add a blank selector reference.");if(void 0===t||null===t||0===t.trim().length)throw new Error("Cannot create a null/undefined selector reference.");var i=this.cleanKey(e),n=this;Object.defineProperty(NGN.ref,i,NGN["private"](t)),Object.defineProperty(NGN.ref,e,{enumerable:!0,get:function(){return n.find(t)},set:function(e){if(void 0===e||null===e||0===e.trim().length)throw new Error("Cannot create a null/undefined selector reference.");NGN.ref[i]=e}}),this.keys[e]=t,this.keys[this.cleanKey(e)]=t}),remove:NGN["const"](function(e){this[e]&&(delete this[e],delete this.keys[e]);var t=this.cleanKey(e);this[t]&&(delete this[t],delete this.keys[t])}),cleanKey:NGN.define(!1,!1,!1,function(e){return e.replace(/[^A-Za-z0-9\_\#\$\@\-\+]/gi,"")+e.length}),json:{enumerable:!0,get:function(){var e=this,t={};return Object.keys(this).forEach(function(i){e.hasOwnProperty(i)&&["json","find","remove"].indexOf(i.trim().toLowerCase())<0&&"function"!=typeof e[i]&&(t[i]=e.keys[i])}),t}}})};var parser=new DOMParser,fs=NGN.nodelike?require("fs"):null,Network=function(){function e(){_classCallCheck(this,e),Object.defineProperties(this,{xhr:NGN.privateconst(function(e){var t=void 0;return window.XMLHttpRequest&&(t=new XMLHttpRequest),t.onreadystatechange=function(){4===t.readyState&&e&&e(t)},t}),run:NGN.privateconst(function(e,t,i){var n=NGN.NET.xhr(i);n.open(e,t,!0),n.send()}),applyRequestSettings:NGN.privateconst(function(e,t){if(!e||!t)throw new Error("No XHR or configuration object defined.");if(t.params){var i=Object.keys(t.params).map(function(e){return e+"="+encodeURIComponent(t.params[e])});t.url+="?"+i.join("&")}e.open(t.method||"POST",t.url,!0),t.header=t.header||t.headers||{},Object.keys(t.header).forEach(function(i){e.setRequestHeader(i,t.header[i])});var n=null;return t.json?((!t.header||t.header&&!t.header["Content-Type"])&&e.setRequestHeader("Content-Type","application/jsoncharset=UTF-8"),n=JSON.stringify(t.json).trim()):t.body?((!t.header||t.header&&!t.header["Content-Type"])&&e.setRequestHeader("Content-Type","application/text"),n=t.body):t.form&&(n=new FormData,Object.keys(t.form).forEach(function(e){n.append(e,t.form[e])})),t.withCredentials&&(e.withCredentials=t.withCredentials),t.username&&t.password?e.setRequestHeader("Authorization","Basic "+btoa(t.username+":"+t.password)):t.accessToken&&e.setRequestHeader("Authorization","Bearer "+t.accessToken),n}),prepend:NGN.privateconst(function(e,t){return e=NGN.slice(e),e.unshift(t),e}),getFile:NGN.privateconst(function(e){if(null!==fs){var t={status:fs.existsSync(e.replace("file://",""))?200:400};return t.responseText=200===t.status?fs.readFileSync(e.replace("file://","")).toString():"File could not be found.",t}throw new Error(e+" does not exist or could not be found.")}),normalizeUrl:NGN.privateconst(function(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/").replace(/\:\/{3,50}/gi,"://")}),processImport:NGN.privateconst(function(e,t,i,n){n=void 0!==n&&n,this["import"](e,function(e){if("string"==typeof e)e=document.createTextNode(e);else if(e.length){var r=function(){var r=[];return NGN.slice(e).forEach(function(e){n?(r.push(t.parentNode.insertBefore(e,t)),t=e):r.push(t.appendChild(e))}),i&&i(r),{v:void 0}}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}n?t.parentNode.insertBefore(e,t):t.appendChild(e),i&&i(e)})}),domainRoot:NGN.privateconst(function(e){var t=e.search(/^https?\:\/\//)!==-1?e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i,""):e.match(/^([^\/?#]+)(?:[\/?#]|$)/i,"");return null===t||t[1].length<3?window.location.host:t[1]}),isCrossOrigin:NGN.privateconst(function(e){return this.domainRoot(e)!==window.location.host}),prelink:NGN.privateconst(function(e,t,i){if(!document.head)return void console.warn("Cannot use a preconnect, predns, etc because there is no HEAD in the HTML document.");var n=document.createElement("link");n.rel=t,n.href="http"!==e.trim().toLowerCase().substr(0,4)?this.normalizeUrl(window.location.origin+window.location.pathname+e):e,NGN.coalesce(i,this.isCrossOrigin(e))&&n.setAttribute("crossorigin","true"),document.head.appendChild(n),NGN.BUS.emit("network."+t)}),importCache:NGN["private"]({}),createElement:NGN.privateconst(function(e){return parser.parseFromString(e,"text/html").querySelector("body").children}),applyData:NGN.privateconst(function(e,t,i){if(void 0===e)return console.warn("Empty template."),void(i&&i());Object.keys(t).forEach(function(i){var n=new RegExp("{{"+i+"}}","gm");e=e.replace(n,t[i])}),e=e.replace(/(\{\{.*\}\})/gm,"");var n=this.createElement(e);i&&i(n[0])})})}return _createClass(e,[{key:"send",value:function(e,t){e=e||{};var i=this.xhr(t),n=this.applyRequestSettings(i,e);i.send(n)}},{key:"get",value:function(){if("object"===_typeof(arguments[0])){var e=arguments[0];return e.method="GET",e.url="string"==typeof arguments[1]?arguments[1]:e.url,e.url.substr(0,4)&&NGN.nodelike?arguments[arguments.length-1](this.getFile(e.url)):this.send(e,arguments[arguments.length-1])}return"file"===arguments[0].substr(0,4)&&NGN.nodelike?arguments[arguments.length-1](this.getFile(arguments[0])):void this.run.apply(this.run,this.prepend(arguments,"GET"))}},{key:"head",value:function(e,t){if("object"===_typeof(arguments[0])){var i=arguments[0];return i.method="HEAD",i.url="string"==typeof arguments[1]?arguments[1]:i.url,this.send(i,arguments[arguments.length-1])}this.run.apply(this.run,this.prepend(arguments,"HEAD"))}},{key:"put",value:function(e,t){e=e||{},e.method="PUT",e.url=e.url||window.location,this.send(e,t)}},{key:"post",value:function(e,t){e=e||{},e.method="POST",e.url=e.url||window.location,this.send(e,t)}},{key:"delete",value:function(){this.run.apply(this.run,this.prepend(arguments,"DELETE"))}},{key:"json",value:function(e,t,i){"string"==typeof e&&(i=t,t=e,e=null),null===e?this.run("GET",t,function(e){if(200!==e.status)throw Error("Could not retrieve JSON data from "+t+" (Status Code: "+e.status+").");try{e.json=JSON.parse(e.responseText)}catch(n){e.json=null}i&&i(e.json)}):(e.url=t,this.get(e,function(e){if(200!==e.status)throw Error("Could not retrieve JSON data from "+t+" (Status Code: "+e.status+").");try{e.json=JSON.parse(e.responseText)}catch(n){e.json=null}i&&i(e.json)}))}},{key:"import",value:function(e,t,i){var n=this;if(Array.isArray(e)){var r=function(){var r=n,o=new Array(e.length),a=0;return e.forEach(function(e,t){r["import"](e,function(e){o[t]=e,a++},i)}),t&&!function(){var i=setInterval(function(){a===e.length&&(clearInterval(i),t(o))},5)}(),{v:void 0}}();if("object"===("undefined"==typeof r?"undefined":_typeof(r)))return r.v}var o=null;try{!function(){o=e.split("/").pop().split("?")[0].split(".").pop().toLowerCase();var i=void 0;"js"===o?(i=document.createElement("script"),i.setAttribute("type","text/javascript"),i.setAttribute("src",e)):"css"===o&&(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e)),i.onload="function"==typeof t?function(){t(i)}:function(){},document.getElementsByTagName("head")[0].appendChild(i)}()}catch(a){}if(!(["js","css"].indexOf((o||"").trim().toLowerCase())>=0)){if(i="boolean"==typeof i&&i,"http"!==e.substr(0,4)){var s=window.location.href.split("/");s.pop(),e=s.join("/")+"/"+e}if(!i&&this.importCache.hasOwnProperty(e)){var l=this.createElement(this.importCache[e]);return t&&t(1===l.length?l[0]:l),void(window.NGN.BUS&&window.NGN.BUS.emit("html.import",1===l.length?l[0]:l))}var c=this;this.get(e,function(i){if(200!==i.status)return console.warn("Check the file path of the snippet that needs to be imported. "+e+" could not be found ("+i.status+")");var n=c.createElement(i.responseText);if(c.importCache[e]=i.responseText,0===n.length)console.warn(c.normalizeUrl(e)+" import has no HTML tags."),t&&t(i.responseText),window.NGN.BUS&&window.NGN.BUS.emit("html.import",i.responseText);else{var r=1===n.length?n[0]:n;t&&t(r),window.NGN.BUS&&window.NGN.BUS.emit("html.import",r)}})}}},{key:"importTo",value:function(e,t,i){this.processImport(e,t,i)}},{key:"importBefore",value:function(e,t,i){this.processImport(e,t,i,!0)}},{key:"predns",value:function(e,t){this.prelink(window.location.protocol+"//"+e,"dns-prefetch",t)}},{key:"preconnect",value:function(e,t){this.prelink(e,"preconnect",t)}},{key:"prefetch",value:function(e,t){this.prelink(e,"prefetch",t)}},{key:"subresource",value:function(e,t){this.prelink(e,"subresource",t)}},{key:"prerender",value:function(e,t){this.prelink(e,"prerender",t)}},{key:"template",value:function(e,t,i){e=this.normalizeUrl(e),"function"==typeof t&&(i=t,t={}),t=t||{};var n=this,r=void 0;return this.importCache.hasOwnProperty(e)?(r=this.importCache[e],this.applyData(r,t,i)):void this.get(e,function(r){var o=null;try{o=e.split("/").pop().split("?")[0].split(".").pop().toLowerCase()}catch(a){}return["js","css"].indexOf((o||"").trim().toLowerCase())>=0?void console.warn("Cannot use a ."+o+" file as a template. Only HTML templates are supported."):(n.importCache[e]=r.responseText,void n.applyData(r.responseText,t,i))})}}]),e}();NGN.NET=new Network;var fuoc=function(){var e=document.createElement("style"),t=document.createTextNode("svg[src]{display:none}svg.loading{height:0px !important;width:0px !important}");e.appendChild(t),document.head.appendChild(e)};fuoc(),NGN.DOM=NGN.DOM||{},NGN.DOM.svg={},Object.defineProperties(NGN.DOM.svg,{_cache:NGN["private"]({}),swap:NGN.privateconst(function(e,t){for(var i=this,n=0;n<e.length;n++){var r=e[n].attributes,o=i._cache[e[n].getAttribute("src")],a=[];try{a=/<svg(\s.*=[\"\'].*?[\"\'])?>/i.exec(o)[1].trim();var s=/[\"\']\s/i.exec(a);s=null!==s?s[0]:'" ',a=a.replace(new RegExp(s,"gi"),s.replace(/\s/gi,",")).split(",")}catch(l){console.error(l)}a=Array.isArray(a)?a:[a];for(var c=a.map(function(e){return e.split("=")[0].trim().toLowerCase()}),d=0;d<r.length;d++){var u=c.indexOf(r[d].name.toLowerCase());u<0?a.push(r[d].name+'="'+r[d].value+'"'):a[u]=r[d].name+'="'+r[d].value+'"'}a=a.filter(function(e){return"src"!==e.split("=")[0].toLowerCase()});var f="<svg "+a.join(" ")+">";e[n].outerHTML=o.replace(/<svg.*?>/i,f)}t&&t()}),id:NGN.privateconst(function(e){return e.replace(/.*\:\/\/|[^A-Za-z0-9]|www/gi,"")}),cleanCode:NGN.privateconst(function(e){try{return e.toString().trim().replace(/(\r\n|\n|\r)/gm,"").replace(/\s+/g," ").match(/\<svg.*\<\/svg\>/gim,"")[0]}catch(t){return""}}),viewbox:NGN.privateconst(function(e){return/(viewbox=["'])(.*?)(["'])/gim.exec(e.toString().trim())[2]||"0 0 100 100"}),cache:NGN["private"](function(e,t){this._cache[e]=t}),fetchFile:NGN["private"](function(e,t){var i=this;if(t)if(NGN.nodelike&&0!==e.indexOf("http")){var n="";try{n=require("fs").readFileSync(require("path").resolve(e).replace("file://","")).toString()}catch(r){try{n=require("fs").readFileSync(require("path").resolve(__dirname,e).replace("file://","")).toString()}catch(o){}}t(n)}else!function(){var n=i;NGN.NET.get(e,function(e){t&&t(200!==e.status?new Error(e.responseText):n.cleanCode(e.responseText))})}()}),update:NGN["const"](function(e,t){if("function"==typeof e?(t=e,e=document.body):e=e||document.body,"#text"!==e.nodeName){var i=this;e=e.hasOwnProperty("length")===!0?NGN._splice(e):[e],e.forEach(function(e){for(var n=e.querySelectorAll("svg[src]"),r=0;r<n.length;r++)i._cache[n[r].getAttribute("src")]=i._cache[n[r].getAttribute("src")]||null;var o=Object.keys(i._cache).filter(function(e){return null===i._cache[e]}),a=o.length;o.forEach(function(e){i.fetchFile(e,function(t){t instanceof Error||i.cache(e,t),a--})});var s=setInterval(function(){0===a&&(clearInterval(s),i.swap(n,t))},5)})}})}),NGN.DATA=NGN.DATA||{},NGN.DATA.util={},Object.defineProperties(NGN.DATA.util,{crcTable:NGN["private"](null),makeCRCTable:NGN.privateconst(function(){for(var e=void 0,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}),checksum:NGN["const"](function(e){for(var t=this.crcTable||(this.crcTable=this.makeCRCTable()),i=-1,n=0;n<e.length;n++)i=i>>>8^t[255&(i^e.charCodeAt(n))];return(i^-1)>>>0}),GUID:NGN["const"](function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&o]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255]})});var Model=function(_NGN$EventEmitter){function Model(e){_classCallCheck(this,Model),e=e||{};var t=_possibleConstructorReturn(this,Object.getPrototypeOf(Model).call(this)),i=t;Object.defineProperties(t,{idAttribute:NGN.privateconst(e.idAttribute||"id"),fields:NGN["private"](e.fields||{id:{required:!0,type:String,"default":e.id||null}}),joins:NGN["private"](e.relationships||{}),virtuals:NGN["private"](e.virtuals||{}),validators:NGN["private"]({}),validation:NGN["public"](NGN.coalesce(e.validation,!0)),isNew:NGN["private"](!0),isDestroyed:NGN["private"](!1),oid:NGN["private"](e[t.idAttribute]||null),autoid:NGN["public"](NGN.coalesce(e.autoid,!1)),benchmark:NGN["private"](null),expiration:NGN["private"](null),expirationTimeout:NGN["private"](null),hasExpired:NGN["private"](!1),ignoreTTL:NGN["private"](!1),createDate:NGN.privateconst(Date.now()),setUnmodified:NGN.privateconst(function(){this.benchmark=this.checksum,this.changelog=[]}),allowInvalidSave:NGN["private"](NGN.coalesce(e.allowInvalidSave,!1)),disableDataValidation:NGN["private"](NGN.coalesce(e.disableDataValidation,!1)),invalidDataAttributes:NGN["private"]([]),initialDataAttributes:NGN["private"]([]),changelog:NGN["private"]([]),_nativeValidators:NGN.privateconst({min:function(e,t){return"array"===NGN["typeof"](t)?t.length>=e:"number"===NGN["typeof"](t)?t>=e:"string"===NGN["typeof"](t)?t.trim().length>=e:"date"===NGN["typeof"](t)&&t.parse()>=e.parse()},max:function(e,t){return"array"===NGN["typeof"](t)?t.length<=e:"number"===NGN["typeof"](t)?t<=e:"string"===NGN["typeof"](t)?t.trim().length<=e:"date"===NGN["typeof"](t)&&t.parse()<=e.parse()},"enum":function(e,t){return e.indexOf(t)>=0},required:function(e,t){return i.hasOwnProperty(e)&&null!==i[t]}}),_dataMap:NGN["private"](e.dataMap||null),_reverseDataMap:NGN["public"](null),raw:NGN["private"]({}),rawjoins:NGN["private"]({}),_store:NGN["private"](null)});var n=t.datafields.concat(t.virtualdatafields).concat(t.relationships).filter(function(e,t,i){return i.indexOf(e)!==t});if(n.length>0)throw new Error("Duplicate field names exist: "+n.join(", ")+". Unique fieldnames are required for data fields, virtuals, and relationship fields.");t.fields.hasOwnProperty("id")||(e.fields.id={required:!0,type:String,"default":e.id||null}),Object.keys(t.fields).forEach(function(e){"object"!==_typeof(i.fields[e])&&null!==i.fields[e]&&(i.fields[e]={required:!0,type:i.fields[e],"default":null,name:e}),i.addField(e,!0)}),Object.keys(t.virtuals).forEach(function(e){Object.defineProperty(i,e,NGN.get(function(){return i.virtuals[e].apply(i)}))}),Object.keys(t.joins).forEach(function(e){i.addRelationshipField(e,i.joins[e],!0)});var r=["field.update","field.create","field.remove","field.invalid","validator.add","validator.remove","relationship.create","relationship.remove","expired"];return NGN.BUS&&r.forEach(function(e){i.on(e,function(){var t=NGN.slice(arguments);t.push(i),t.unshift(e),NGN.BUS.emit.apply(NGN.BUS,t)})}),e.hasOwnProperty("expires")&&(t.expires=e.expires),t}return _inherits(Model,_NGN$EventEmitter),_createClass(Model,[{key:"expire",value:function(e){if(!this.expired)return e?void(this.expires=e):void(this.ignoreTTL||(this.hasExpired=!0,clearTimeout(this.expirationTimeout),this.emit("expired",this)))}},{key:"disableExpiration",value:function(){this.expires=-1}},{key:"addValidator",value:function(e,t){if(!this.hasOwnProperty(e))return void console.warn("No validator could be create for %c"+e+"%c. It is not an attribute of %c"+this.type+"%c.",NGN.css,"",NGN.css,"");switch("undefined"==typeof t?"undefined":_typeof(t)){case"function":this.validators[e]=this.validators[e]||[],this.validators[e].push(t),this.emit("validator.add",e);break;case"object":Array.isArray(t)?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.indexOf(e)>=0}),this.emit("validator.add",e)):t.test?(this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return t.test(e)}),this.emit("validator.add",e)):console.warn("No validator could be created for %c"+e+"%c. The validator appears to be invalid.",NGN.css,"");break;case"string":case"number":case"date":this.validators[e]=this.validators[e]||[],this.validators[e].push(function(e){return e===t}),this.emit("validator.add",e);break;default:console.warn("No validator could be create for %c"+e+"%c. The validator appears to be invalid.",NGN.css,"")}}},{key:"removeValidator",value:function(e){this.validators.hasOwnProperty(e)&&(delete this.validators[e],this.emit("validator.remove",e))}},{key:"validate",value:function(e){if(!this.validation)return!0;var t=this;if(e){if(this.validators.hasOwnProperty(e)){for(var i=0;i<this.validators[e].length;i++){if(!t.validators[e][i].apply(t,[t[e]]))return t.invalidDataAttributes.indexOf(e)<0&&t.invalidDataAttributes.push(e),!1;t.invalidDataAttributes=t.invalidDataAttributes.filter(function(t){return e!==t})}if(!this.validateDataType(e))return this.invalidDataAttributes.push(e),!1}return!0}this.datafields.forEach(function(e){t.validate(e)})}},{key:"validateDataType",value:function(e){var t=NGN["typeof"](this[e]),i=NGN["typeof"](this.fields[e].type);return"null"!==t?t===i:null!==this[e]||!this.fields[e].required||!(!this.autoid||e!==this.idAttribute)}},{key:"getRelationshipField",value:function(e){return this.joins[e]}},{key:"hasRelationship",value:function(e){return this.joins.hasOwnProperty(e)}},{key:"getDataField",value:function(e){return this.fields[e]}},{key:"hasDataField",value:function(e){return this.fields.hasOwnProperty(e)}},{key:"serialize",value:function(e){var t=e||this.raw,i={};for(var n in t)if(t.nonEnumerableProperties=t.nonEnumerableProperties||"",this.fields.hasOwnProperty(n)&&(n="id"===n?this.idAttribute:n,t.hasOwnProperty(n)&&t.nonEnumerableProperties.indexOf(n)<0&&/^[a-z0-9 ]$/.test(n.substr(0,1))||void 0!==t[n]&&t.enumerableProperties.indexOf(n)>=0)){var r=Object.getOwnPropertyDescriptor(t,n);if(!r.set)switch(_typeof(r.value)){case"function":
"Date"===r.value.name?i[n]=t[n].refs.toJSON():"RegExp"===r.value.name&&(i[n]=r.value());break;case"object":t[n]instanceof Array&&!Array.isArray(t[n])&&(t[n]=t[n].slice(0)),i[n]=t[n];break;default:i[n]=t[n]}}var o=this;return this.relationships.forEach(function(e){i[e]=o.rawjoins[e].data}),i}},{key:"addField",value:function addField(field,fieldcfg,suppressEvents){"boolean"==typeof fieldcfg&&(suppressEvents=fieldcfg,fieldcfg=null),suppressEvents=void 0!==suppressEvents&&suppressEvents;var me=this,cfg=null;if("id"!==field.toLowerCase()){if("object"===("undefined"==typeof field?"undefined":_typeof(field))){if(!field.name)throw new Error("Cannot create data field. The supplied configuration does not contain a unique data field name.");cfg=field,field=cfg.name,delete cfg.name}if(void 0!==me[field]){try{var source=NGN.stack.pop();console.warn("%c"+field+"%c data field defined multiple times (at %c"+source.path+"%c). Only the last defintion will be used.",NGN.css,"",NGN.css,"")}catch(e){console.warn("%c"+field+"%c data field defined multiple times. Only the last definition will be used.",NGN.css,"",NGN.css,"")}delete me[field]}if(me.fields[field]=cfg||me.fields[field]||{},me.fields[field].required=NGN.coalesce(me.fields[field].required,!1),!me.fields[field].hasOwnProperty("type")&&me.fields[field].hasOwnProperty("default")){var type=NGN["typeof"](me.fields[field]["default"]);type=type.charAt(0).toUpperCase()+type.slice(1),me.fields[field].type=eval(type)}if(me.fields[field].type=NGN.coalesce(me.fields[field].type,String),field===me.idAttribute&&me.autoid===!0?(me.fields[field].type=String,me.fields[field]["default"]=NGN.DATA.util.GUID()):me.fields[field]["default"]=me.fields[field]["default"]||null,me.raw[field]=me.fields[field]["default"],me[field]=me.raw[field],Object.defineProperty(me,field,{get:function(){return me.raw[field]},set:function(e){var t=me.raw[field],i=!me.validate(field);me.raw[field]=e;var n={action:"update",field:field,old:t,"new":me.raw[field]};this.changelog.push(n),this.emit("field.update",n),this.emit("field.update."+field,n),me.validate(field)?i&&me.emit("field.valid",{field:field}):me.emit("field.invalid",{field:field})}}),!suppressEvents){var c={action:"create",field:field};this.changelog.push(c),this.emit("field.create",c)}if(me.fields.hasOwnProperty(field)&&(me.fields[field].hasOwnProperty("pattern")&&me.addValidator(field,me.fields[field].pattern),["min","max","enum"].forEach(function(e){me.fields[field].hasOwnProperty(e)&&me.addValidator(field,function(t){return me._nativeValidators[e](me.fields[field][e],t)})}),me.fields[field].hasOwnProperty("required")&&me.fields[field].required&&me.addValidator(field,function(e){return me._nativeValidators.required(field,e)}),me.fields[field].hasOwnProperty("validate")))if("function"==typeof me.fields[field].validate)me.addValidator(field,function(e){return me.fields[field].validate.apply(me,[e])});else{var _source=NGN.stack.pop();console.warn("Invalid custom validation function (in %c"+_source.path+"%c). The value passed to the validate attribute must be a function.",NGN.css,"")}}else null===me.id&&me.autoid&&(me.id=NGN.DATA.util.GUID())}},{key:"addVirtual",value:function(e,t){var i=this;Object.defineProperty(this,e,{get:function(){return t.apply(i)}})}},{key:"addRelationshipField",value:function(e,t,i){if(i=void 0!==i&&i,this.rawjoins.hasOwnProperty(e)||this.fields.hasOwnProperty(e)||this.hasOwnProperty(e))throw new Error(e+" already exists. It cannot be added to the model again.");if(("function"==typeof t||"object"===("undefined"==typeof t?"undefined":_typeof(t))&&!t.hasOwnProperty("type"))&&(t={type:t}),!t.type)throw new Error("Configuration has no reference! The reference must be an NGN.DATA.Model or NGN.DATA.Store.");t.required=NGN.coalesce(t.required,!0),t["default"]=t["default"]||null;var n=this,r="model";if(t.type instanceof NGN.DATA.Store)r="store";else if("array"===NGN["typeof"](t.type)){if(0===t.type.length)throw new Error(e+" cannot be an empty store. A model must be provided.");r="collection"}else"object"===_typeof(t.type)&&t.type.model&&(r="store");if("store"===r){var o={};if(t.type instanceof NGN.DATA.Store)this.rawjoins[e]=t.type,o=null;else{if(!t.type.model)throw new Error("Nested store configuration is invalid or was not recognized.");o=t.type}null!==o&&(this.rawjoins[e]=new NGN.DATA.Store(o)),this.applyStoreMonitor(e)}else if("collection"===r)this.rawjoins[e]=new NGN.DATA.Store({model:t.type[0]}),this.applyStoreMonitor(e);else if(t.type.data){if(!t.type.data)throw new Error("Nested store configuration is invalid or was not recognized.");this.rawjoins[e]=t.type,this.applyStoreMonitor(e)}else this.rawjoins[e]=null!==t["default"]?new t.type(t["default"]):new t.type,this.applyModelMonitor(e);if(Object.defineProperty(this,e,{enumerable:!0,get:function(){return n.rawjoins[e]}}),!i){var a={action:"create",field:e};this.changelog.push(a),this.emit("relationship.create",a)}}},{key:"applyModelMonitor",value:function(e){var t=this.rawjoins[e],i=this;t.on("field.update",function(n){var r={action:"update",field:e+"."+n.field,old:n.old,"new":n["new"],join:!0,originalEvent:{event:"field.update",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.create",function(n){var r={action:"update",field:e+"."+n.field,old:null,"new":null,join:!0,originalEvent:{event:"field.create",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.remove",function(n){var r={action:"update",field:e+"."+n.field,old:n.value,"new":null,join:!0,originalEvent:{event:"field.remove",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}),t.on("field.invalid",function(t){i.emit("field.invalid"),i.emit("field.invalid."+e+"."+t.field)}),t.on("field.valid",function(t){i.emit("field.valid"),i.emit("field.valid."+e+"."+t.field)})}},{key:"applyStoreMonitor",value:function(e){var t=this;this.rawjoins.hasOwnProperty(e)&&this.rawjoins[e].hasOwnProperty("proxy")&&!function(){var i=t;t.rawjoins[e].on("record.create",function(t){var n=i[e].data;n.pop();var r={action:"update",field:e,join:!0,old:n,"new":i[e].data,originalEvent:{event:"record.create",record:t}};i.emit("field.update",r),i.emit("field.update."+e,r)}),t.rawjoins[e].on("record.update",function(t,n){if(n){var r={action:"update",field:e+"."+n.field,join:!0,old:n.old,"new":n["new"],originalEvent:{event:"record.update",record:t}};i.emit("field.update",r),i.emit("field.update."+e+"."+n.field,r)}}),t.rawjoins[e].on("record.delete",function(t){var n=i[e].data;n.push(t.data);var r={action:"update",field:e,join:!0,old:n,"new":i[e].data,originalEvent:{event:"record.delete",record:t}};i.emit("field.update",r),i.emit("field.update."+e,r)}),t.rawjoins[e].on("record.invalid",function(t){i.emit("field.invalid",t.field),i.emit("field.invalid."+e,t.field)}),t.rawjoins[e].on("record.valid",function(t){i.emit("field.valid",t.field),i.emit("field.valid."+e,t.field)})}()}},{key:"removeField",value:function(e){if(this.raw.hasOwnProperty(e)){var t=this.raw[e];delete this[e],delete this.fields[e],delete this.raw[e],this.invalidDataAttributes.indexOf(e)>=0&&this.invalidDataAttributes.splice(this.invalidDataAttributes.indexOf(e),1);var i={action:"delete",field:e,value:t};this.emit("field.remove",i),this.changelog.push(i)}}},{key:"removeVirtual",value:function(e){delete this[e]}},{key:"removeRelationshipField",value:function(e,t){if(t=void 0!==t&&t,this.joins.hasOwnProperty(e)){var i=this.rawjoins[e];if(delete this.rawjoins[e],delete this[e],delete this.joins[e],!t){var n={action:"delete",field:e,old:i,join:!0};this.changelog.push(n),this.emit("relationship.remove",n)}}}},{key:"undo",value:function(e){e=e||1;var t=this.changelog.splice(this.changelog.length-e,e),i=this;t.reverse().forEach(function(e){if("boolean"==typeof e.join&&e.join)switch(e.action){case"create":i.removeRelationshipField(e.field);break;case"delete":i.addRelationshipField(e.field),i[e.field]=e.old}else switch(e.action){case"update":i[e.field]=e.old;break;case"create":i.removeField(e.field);break;case"delete":i.addField(e.field),i[e.field]=i.old}})}},{key:"load",value:function(e){e=e||{};var t=this;null!==this._dataMap&&Object.keys(this.reverseMap).forEach(function(i){e.hasOwnProperty(i)&&(e[t.reverseMap[i]]=e[i],delete e[i])}),Object.keys(e).forEach(function(i){if(t.fields.hasOwnProperty(i))t.raw.hasOwnProperty(i)?t.raw[i]=e[i]:i===t.idAttribute&&(t.id=e[i]);else if(t.joins.hasOwnProperty(i))t.rawjoins[i].load(e[i]);else try{var n=NGN.stack.pop();console.warn("%c"+i+"%c specified in %c"+n.path+"%c as a data field but is not defined in the model.",NGN.css,"",NGN.css,"")}catch(r){console.warn("%c"+i+"%c specified as a data field but is not defined in the model.",NGN.css,"")}}),this.setUnmodified()}},{key:"expires",get:function(){return this.expiration},set:function(e){var t=this;if("date"===NGN["typeof"](e)||"number"===NGN["typeof"](e)){if(clearTimeout(this.expirationTimeout),"number"===NGN["typeof"](e)){if(e<0)return void(this.ignoreTTL=!0);var i=new Date;e=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()+e)}if(this.ignoreTTL=!1,this.expiration=e,Date.now()>=this.expiration.getTime())return void this.expire();this.hasExpired=!1;var n=this.expiration.getTime()-Date.now();this.expirationTimeout=setTimeout(function(){t.expire()},n)}else try{var r=NGN.stack.pop();console.warn("Expiration could not be set at %c"+r.path+"%c (Invalid data type. Must be a Date or number).",NGN.css,"")}catch(o){console.warn("Expiration could not be set (Invalid data type. Must be a Date or number).")}}},{key:"expired",get:function(){return!this.ignoreTTL&&this.hasExpired}},{key:"modified",get:function(){return this.checksum!==this.benchmark}},{key:"id",get:function(){return this.oid},set:function(e){this.oid=e}},{key:"checksum",get:function(){return NGN.DATA.util.checksum(JSON.stringify(this.data))}},{key:"dataMap",get:function(){return this._dataMap},set:function(e){this._dataMap=e,this._reverseDataMap=null}},{key:"datastore",get:function(){return this._store}},{key:"valid",get:function(){return this.validate(),0===this.invalidDataAttributes.length}},{key:"datafields",get:function(){return Object.keys(this.fields)}},{key:"relationships",get:function(){return Object.keys(this.joins)}},{key:"virtualdatafields",get:function(){return Object.keys(this.virtuals)}},{key:"reverseMap",get:function(){var e=this;if(null!==this.dataMap){var t=function(){if(null!==e._reverseDataMap)return{v:e._reverseDataMap};var t={},i=e;return Object.keys(e._dataMap).forEach(function(e){t[i._dataMap[e]]=e}),e._reverseDataMap=t,{v:t}}();if("object"===("undefined"==typeof t?"undefined":_typeof(t)))return t.v}return null}},{key:"data",get:function(){var e=this,t=this.serialize();return!t.hasOwnProperty(this.idAttribute)&&this.autoid&&(t[this.idAttribute]=this[this.idAttribute]),this.dataMap&&!function(){var i=e;Object.keys(e.dataMap).forEach(function(e){t.hasOwnProperty(e)&&(t[e]instanceof NGN.DATA.Model?t[i.dataMap[e]]=t[e].data:t[i.dataMap[e]]=t[e],delete t[e])})}(),t}},{key:"history",get:function(){return this.changelog.reverse()}}]),Model}(NGN.EventEmitter);NGN.DATA=NGN.DATA||{},Object.defineProperties(NGN.DATA,{Model:NGN["public"](function(e){var t=function(t){var i=new Model(e);return t&&i.load(t),i};return t}),Entity:NGN["private"](Model)}),NGN.nodelike&&(module.exports=NGN.DATA);var Store=function(e){function t(e){_classCallCheck(this,t),e=e||{};var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));Object.defineProperties(i,{model:NGN["const"](e.model||null),_data:NGN["private"]([]),_filters:NGN["private"]([]),_index:NGN["private"](e.index||[]),_created:NGN["private"]([]),_deleted:NGN["private"]([]),_loading:NGN["private"](!1),_softarchive:NGN["private"]([]),proxy:NGN["private"](null),allowDuplicates:NGN["public"](NGN.coalesce(e.allowDuplicates,!0)),errorOnDuplicate:NGN["const"](NGN.coalesce(e.errorOnDuplicate,e.allowDuplicates,!0)),autoRemoveExpiredRecords:NGN.privateconst(NGN.coalesce(e.autoRemoveExpiredRecords,!0)),softDelete:NGN.privateconst(NGN.coalesce(e.softDelete,!1)),softDeleteTtl:NGN["private"](NGN.coalesce(e.softDeleteTtl,-1))});var n={};i._index.forEach(function(e){n[e]=[]}),i._index=n;var r=["record.duplicate","record.create","record.update","record.delete","record.restored","record.purged","record.move","record.invalid","record.valid","clear","filter.create","filter.delete","index.create","index.delete"];return NGN.BUS&&r.forEach(function(e){i.on(e,function(){var t=NGN.slice(arguments);t.shift(),t.push(this),NGN.BUS.emit(e,t)})}),i}return _inherits(t,e),_createClass(t,[{key:"add",value:function(e,t){var i=void 0;if(e instanceof NGN.DATA.Entity)i=e;else{try{e=JSON.parse(e)}catch(n){}if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw new Error("Cannot add a non-object record.");i=this.model?new this.model(e):e}i.hasOwnProperty("_store")&&(i._store=this);var r=this.isDuplicate(i);if(!r||(this.emit("record.duplicate",i),this.allowDuplicates))return this.listen(i),this.applyIndices(i,this._data.length),this._data.push(i),!this._loading&&this._created.indexOf(i)<0&&this._created.push(i),NGN.coalesce(t,!1)||this.emit("record.create",i),i.valid||this.emit("record.invalid",i),i;if(this.errorOnDuplicate)throw new Error("Cannot add duplicate record (allowDuplicates = false).")}},{key:"insertBefore",value:function(e,t){var i=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return this.insert(e,t,i,"before")}},{key:"insertAfter",value:function(e,t){var i=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return this.insert(e+1,t,i,"after")}},{key:"insert",value:function(e,t){var i=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],n=arguments.length<=3||void 0===arguments[3]?"after":arguments[3],r=this.add(t,!0);return r&&(this.move(this._data.length-1,e,n,!1),i||this.emit("record.create",r)),r}},{key:"isDuplicate",value:function(e){return!(this._data.indexOf(e)>=0)&&this._data.filter(function(t){return t.checksum===e.checksum}).length>0}},{key:"listen",value:function(e){var t=this;e.on("field.update",function(i){t.updateIndice(i.field,i.old,i["new"],t._data.indexOf(e)),t.emit("record.update",e,i)}),e.on("field.delete",function(i){t.updateIndice(i.field,i.old,void 0,t._data.indexOf(e)),t.emit("record.update",e,i)}),e.on("field.invalid",function(){t.emit("record.invalid",e)}),e.on("field.valid",function(){t.emit("record.valid",e)}),e.on("expired",function(){e.expired&&(t.emit("record.expired",e),t.autoRemoveExpiredRecords&&t.remove(e))})}},{key:"bulk",value:function(e,t){var i=this;this._loading=!0,t.forEach(function(e){i.add(e,!0)}),this._loading=!1,this._deleted=[],this._created=[],this.emit(e||"load")}},{key:"load",value:function(){var e=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("load",e)}},{key:"reload",value:function(e){this.clear();var t=Array.isArray(arguments[0])?arguments[0]:NGN.slice(arguments);this.bulk("reload",t)}},{key:"indexOf",value:function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&(e instanceof NGN.DATA.Entity||e.checksum)?this._data.findIndex(function(t){return t.checksum===e.checksum}):-1}},{key:"contains",value:function(e){return this.indexOf(e)>=0}},{key:"remove",value:function(e,t){var i=this,n=[],r=void 0;if("number"==typeof e?r=e:e&&e.checksum&&null!==e.checksum||e instanceof NGN.DATA.Model?r=this.indexOf(e):!function(){var t=new i.model(e,(!0));r=i._data.findIndex(function(e){return e.checksum===t.checksum})}(),r<0)throw new Error("Record removal failed (record not found at index "+(r||"").toString()+").");if(n=this._data.splice(r,1),n.length>0){if(n=n[0],this.unapplyIndices(r),this.softDelete&&(this.softDeleteTtl>=0&&!function(){var e=n.checksum;n.once("expired",function(){i.purgeDeletedRecord(e)}),n.expires=i.softDeleteTtl}(),this._softarchive.push(n)),!this._loading){var o=this._created.indexOf(n);o>=0?o>=0&&this._created.splice(o,1):this._deleted.indexOf(n)<0&&this._deleted.push(n)}return NGN.coalesce(t,!1)||this.emit("record.delete",n,r),n}return null}},{key:"findArchivedRecord",value:function(e){var t=void 0,i=this._softarchive.filter(function(i,n){if(i.checksum===e)return t=n,!0});if(1!==i.length){var n=void 0;try{n=NGN.stack.pop().path}catch(r){n="Unknown"}return console.warn("Cannot purge record. %c"+i.length+" records found%c. Source: %c"+n,NGN.css,"",NGN.css),null}return{index:t,record:i[0]}}},{key:"purgeDeletedRecord",value:function(e){var t=this.findArchivedRecord(e);return null===t?null:(this._softarchive.splice(t.index,1),this.emit("record.purged",t.record),t.record)}},{key:"restore",value:function(e){var t=this.findArchivedRecord(e);return null===t?null:(t.record.removeAllListeners("expired"),t.record.expires=this.softDeleteTtl,this.add(t.record,!0),this._softarchive[t.index].removeAllListeners("expired"),this._softarchive.splice(t.index,1),this.emit("record.restored",t.record),t.record)}},{key:"clear",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0];t?this._softarchive=[]:this._softarchive=this._data,this._data=[],Object.keys(this._index).forEach(function(t){e._index[t]=[]}),this.emit("clear")}},{key:"find",value:function(e,t){var i=this;if(0===this._data.length)return[];var n=[],r=function(){switch("undefined"==typeof e?"undefined":_typeof(e)){case"function":n=i._data.filter(e);break;case"number":n=e<0||e>=i._data.length?null:i._data[e];break;case"string":var t=i.getIndices(i._data[0].idAttribute,e.trim());if(null!==t&&t.length>0)return t.forEach(function(e){n.push(i._data[e])}),{v:n};var r=i._data.filter(function(t){return(t[t.idAttribute]||"").toString().trim()===e.trim()});n=0===r.length?null:r[0];break;case"object":if(e instanceof NGN.DATA.Model)return i.contains(e)?{v:e}:{v:null};var o=[],a=[],s=Object.keys(e);s.forEach(function(t){var n=i.getIndices(t,e[t]);n?o=o.concat(n||[]):null!==t&&a.push(t)}),o.filter(function(e,t){return o.indexOf(e)===t}),a.length>0&&(n=i._data.filter(function(t,i){if(o.indexOf(i)>=0)return!1;for(var n=0;n<a.length;n++)if(t[a[n]]!==e[a[n]])return!1;return!0})),n=n.concat(o.map(function(e){return i._data[e]})).filter(function(t){for(var i=0;i<s.length;i++)if(e[s[i]]!==t[s[i]])return!1;return!0});break;default:n=i._data}}();return"object"===("undefined"==typeof r?"undefined":_typeof(r))?r.v:null===n?null:(NGN.coalesce(t,!1)||this.applyFilters(n instanceof Array?n:[n]),n)}},{key:"applyFilters",value:function(e){return 0===this._filters.length?e:(this._filters.forEach(function(t){e=e.filter(t)}),e)}},{key:"addFilter",value:function(e){this._filters.push(e),this.emit("filter.create",e)}},{key:"removeFilter",value:function(e,t){t=NGN.coalesce(t,!1);var i=[];i="number"==typeof e?this._filters.splice(e,1):this._filters.splice(this._filters.indexOf(e),1),i.length>0&&!t&&this.emit("filter.delete",i[0])}},{key:"clearFilters",value:function(e){if(e=NGN.coalesce(e,!1))return void(this._filters=[]);for(;this._filters.length>0;)this.emit("filter.delete",this._filters.pop())}},{key:"deduplicate",value:function(e){var t=this;e=NGN.coalesce(e,!0);var i=this.data.map(function(e){return JSON.stringify(e)}),n=[];i.forEach(function(e,r){i.indexOf(e)<r&&n.push(t.find(r))}),n.forEach(function(e){t.remove(e)})}},{key:"sort",value:function(e){var t=this;"function"==typeof e?this.records.sort(e):"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!function(){var i=Object.keys(e);t._data.sort(function(t,n){for(var r=0;r<i.length;r++){if(t.hasOwnProperty(i[r])&&!n.hasOwnProperty(i[r]))return 1;if(!t.hasOwnProperty(i[r])&&n.hasOwnProperty(i[r]))return-1;if(t[i[r]]!==n[i[r]])switch(e[i[r]].toString().trim().toLowerCase()){case"asc":return _typeof(t.fields[i[r]])?t[i[r]].localeCompare(n[i[r]]):t[i[r]]>n[i[r]]?1:-1;case"desc":return t[i[r]]<n[i[r]]?1:-1;default:return"function"==typeof e[i[r]]?e[i[r]](t,n):0}}return 0})}(),this.reindex()}},{key:"createIndex",value:function(e,t){this.model.hasOwnProperty(e)||console.warn("The store's model does not contain a data field called %c"+e+"%c.",NGN.css,"");var i=this._index.hasOwnProperty(e);this._index[e]=this._index[e]||[],NGN.coalesce(t,!1)||i||this.emit("index.created",{field:e,store:this})}},{key:"deleteIndex",value:function(e,t){this._index.hasOwnProperty(e)&&(delete this._index[e],NGN.coalesce(t,!1)||this.emit("index.created",{field:e,store:this}))}},{key:"clearIndices",value:function(){var e=this;Object.keys(this._index).forEach(function(t){e._index[t]=[]})}},{key:"deleteIndexes",value:function(e){var t=this;e=NGN.coalesce(e,!0),Object.keys(this._index).forEach(function(i){t.deleteIndex(i,e)})}},{key:"applyIndices",value:function(e,t){var i=this,n=Object.keys(this._index);0!==n.length&&n.forEach(function(n){if(e.hasOwnProperty(n)){for(var r=i._index[n],o=0;o<r.length;o++)if(r[o][0]===e[n])return void i._index[n][o].push(t);i._index[n].push([e[n],t])}})}},{key:"unapplyIndices",value:function(e){var t=this;Object.keys(this._index).forEach(function(i){var n=t._index[i].indexOf(e);n>=0&&t._index[i].splice(n,1)})}},{key:"updateIndice",value:function(e,t,i,n){if(this._index.hasOwnProperty(e)&&t!==i)for(var r=0,o=0;o<this._index[e].length;o++){var a=this._index[e][o][0];if(a===t?(this._index[e][o].splice(this._index[e][o].indexOf(n),1),r++):void 0===i?r++:a===i&&(this._index[e][o].push(n),this._index[e][o].shift(),this._index[e][o].sort(),this._index[e][o].unshift(a),r++),2===r)return}}},{key:"getIndices",value:function(e,t){if(!this._index.hasOwnProperty(e))return null;var i=this._index[e].filter(function(e){return e.length>0&&e[0]===t});return 1===i.length?(i[0].shift(),i[0]):[]}},{key:"move",value:function(e,t){var i=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return void 0===e?void console.warn("Cannot move record. No source specified."):void 0===t?void console.warn("Cannot move record. No target specified."):(e=this.getRecordIndex(e),t=this.getRecordIndex(t),void(e!==t&&(this._data.splice(t,0,this._data.splice(e,1)[0]),i||this.emit("record.move",{oldIndex:e,newIndex:t,record:this._data[t]}),this.reindex())))}},{key:"getRecordIndex",value:function(e){if(void 0===e)return console.warn("No argument passed to getRecordIndex()."),null;if("number"==typeof e)return e<0||e>=this._data.length?(console.warn("%c"+e+"%c out of bounds.",NGN.css,""),null):e;if("string"==typeof e){var t=e;if(e=this.find(t),!e)return console.warn("%c"+t+"%c does not exist or cannot be found in the store.",NGN.css,""),null}return this.indexOf(e)}},{key:"reindex",value:function(){var e=this;this.clearIndices(),this._data.forEach(function(t,i){e.applyIndices(t,i)})}},{key:"data",get:function(){return this._data.map(function(e){return e.data})}},{key:"records",get:function(){return this.applyFilters(this._data)}},{key:"recordCount",get:function(){return this.applyFilters(this._data).length}},{key:"filtered",get:function(){var e=this.records;return this._data.filter(function(t){return 0===e.filter(function(e){return e.checksum===t.checksum}).length})}},{key:"first",get:function(){return 0===this.records.length?null:this.records[0]}},{key:"last",get:function(){return 0===this.records.length?null:this.records[this.records.length-1]}}]),t}(NGN.EventEmitter);NGN.DATA.Store=Store;var Proxy=function(e){function t(e){if(_classCallCheck(this,t),e=e||{},!e.store)throw new Error("NGN.DATA.Proxy requires a NGN.DATA.Store.");var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.store.proxy=i,Object.defineProperties(i,{store:NGN["const"](e.store),url:NGN["public"](e.url||"http://localhost"),username:NGN["public"](e.username||null),password:NGN["public"](e.password||null),token:NGN["public"](e.token||null)}),i}return _inherits(t,e),_createClass(t,[{key:"save",value:function(){console.warn("Save should be overridden by a proxy implementation class.")}},{key:"fetch",value:function(){console.warn("Fetch should be overridden by a proxy implementation class.")}},{key:"actions",get:function(){var e=this;return{create:this.store._created,update:this.store.records.filter(function(t){return!(e.store._created.indexOf(t)<0&&e.store._deleted.indexOf(t)<0)&&t.modified}).map(function(e){return e}),"delete":this.store._deleted}}}]),t}(NGN.EventEmitter);Object.defineProperty(NGN.DATA,"Proxy",NGN["const"](Proxy));
//# sourceMappingURL=https://ngnjs.github.io/cdn/assets/chassis-lib/sourcemaps/1.0.120/chassis.min.js.map